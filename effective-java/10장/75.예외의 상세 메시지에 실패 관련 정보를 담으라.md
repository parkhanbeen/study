# 예외의 상세 메시지에 실패 관련 정보를 담으라

* 분석을 위해 실패 순간의 상황을 정확히 포착해 예외의 상세 메시지에 담아야 한다.
* **실패 순간을 포착하려면 발생한 예외에 관여된 모든 매개변수와 필드의 값을 실패 메시지에 담아야 한다.**

## 상세 메시지 작성법

* 관련 데이터를 모두 담아야 하지만 장황할 필요는 없다.
* 스택 추적에는 예외가 발생한 파일 이름과 줄번호는 물론 스택에서 호출한 다른 메서드들의 파일 이름과 줄번호까지 정확히 기록되어 있는 게 보통이다.
  * 그러니 문서와 소스코드에서 얻을 수 있는 정보는 불필요 할 수 있다.
* 예외의 상세 메시지와 최종 사용자에게 보여줄 오류 메시지를 혼동해서는 안 된다.
  * 최종 사용자에게는 친절한 안내 메시지를 보여줘야 하는 반면,
  * 예외 메시지는 가독성보다는 담긴 내용이 훨씬 중요하다.
  * 예외 메시지의 주 소비층은 문제를 분석할 프로그래머와 SRE 엔지니어이기 때문이다.
* 실패를 적절히 포착하려면 필요한 정보를 예외 생성자에서 모두 받아서 상세 메시지까지 미리 생성해놓는 방법도 괜찮다.

```java
/**
 * IndexOutOfBoundsException을 생성한다.
 * 
 * @param lowerBound 인덱스 최솟값
 * @param upperBound 인덱스 최솟값 + 1
 * @param index      인덱스의 실젯값
 */
public IndexOutOfBoundsException(int lowerBound, int upperBound, int index) {
    // 실패를 포착하는 상세 메시지를 생성한다.
    super(String.format("최솟값: %d, 최댓값: %d, 인덱스: %d", lowerBound, upperBound, index));
    
    // 프로그램에서 이용할 수 있도록 실패 정보를 저장해둔다.
    this.lowerBound = lowerBound;
    this.upperBound = upperBound;
    this.index = index;
}
```

* 자바 9에서는 `IndexOutOfBoundsException`에 드디어 정수 인덱스 값을 받는 생성자가 추가되었다.
  * 하지만, 최솟값과 최댓값까지는 받지 않는다.
* 위 코드처럼 작성하면 예외는 자연스럽게 실패를 잘 포착한다.
* 또한 고품질의 상세 메시지를 만들어내는 코드를 예외 클래스 안으로 모아주는 효과도 있어, 클래스 사용자가 메시지를 만드는 작업을 중복으로 하지 않아도 된다.

### 예외 클래스 접근자 메서드

* [아이템 70](https://github.com/parkhanbeen/study/blob/master/effective-java/10%EC%9E%A5/70.%EB%B3%B5%EA%B5%AC%ED%95%A0%20%EC%88%98%20%EC%9E%88%EB%8A%94%20%EC%83%81%ED%99%A9%EC%97%90%EB%8A%94%20%EA%B2%80%EC%82%AC%20%EC%98%88%EC%99%B8%EB%A5%BC%2C%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%20%EC%98%A4%EB%A5%98%EC%97%90%EB%8A%94%20%EB%9F%B0%ED%83%80%EC%9E%84%20%EC%98%88%EC%99%B8%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%98%EB%9D%BC.md)에서 제안하였듯, 예외는 실패와 관련한 정보를 얻을 수 있는 접근자 메서드를 적절히 제공하는 것이 좋다.
* 포착한 실패 정보는 예외 상황을 복구하는데 유용할 수 있으므로 접근자 메서드는 비검사 예외보다는 검사 예외에서 더 빛을 발한다.
  * 하지만 비검사 예외라도 상세 정보를 알려주는 접근자 메서드를 제공하는 편이 좋다.

## 정리

* 분석을 위해서 예외에 실패 상세 메시지를 담도록 하자.
  * 하지만 상세 메시지에 **비밀번호나 암호키 같은 보안 관련된 정보**는 담아서는 안 된다.
